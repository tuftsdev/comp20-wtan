<head>
<meta charset="utf-8">
<link href="notuber.css" rel="stylesheet">
<script src="https://maps.google.com/maps/api/js?key=AIzaSyD8Qzk7JOJCbvQZolgTXmisRjjMZ_cqIsk"></script>
<!-- Write Javascript in Html file, key: key=AIzaSyD8Qzk7JOJCbvQZolgTXmisRjjMZ_cqIsk-->
<script type="text/javascript">
function getLocation(){
	var apiSearch = new XMLHttpRequest();
	apiSearch.open("POST", "https://defense-in-derpth.herokuapp.com/submit",true);
	apiSearch.setRequestHeader("Content-type","application/x-www-form-urlencoded");
	if (navigator.geolocation){
		navigator.geolocation.getCurrentPosition(function(position){
			lat = position.coords.latitude;
			lng = position.coords.longitude;
			var bounds = new google.maps.LatLngBounds();
			apiSearch.send("username=6NVPzKEi&lat="+lat+"&lng="+lng);
			var me = new google.maps.LatLng(lat, lng);
			var specs = {
				zoom: 17,
				center: me,
				mapTypeID: google.maps.MapTypeId.ROADMAP
			};
			var mappy= new google.maps.Map(document.getElementById("map_canvas"), specs);
			var marker = new google.maps.Marker({position:me,
				title:"me", map:mappy
				/*icon:"stick-man-297255_640.png"*/})
			apiSearch.onreadystatechange=function(){
				if(apiSearch.readyState==4){
					coordlist=JSON.parse(apiSearch.responseText);
					console.log(apiSearch.responseText);
					console.log(coordlist);
					var markerList=[];
					if ('vehicles' in coordlist){
						console.log('yay');
						for(i=0;i<coordlist["vehicles"].length;i++){
							var positioni=new google.maps.LatLng(coordlist['vehicles'][i].lat,coordlist['vehicles'][i].lng);
							bounds.extend(positioni);
							markerList[i]=new google.maps.Marker({position:positioni,
							title:coordlist['vehicles'][i].username, map:mappy});					
						}
					}
				}
			}
			//https://pixabay.com/en/stick-man-walking-hiking-sign-297255/
		});
	}
	else{
		console.log('geolocation not supported');
	}
	

}

function selfgeolocation(apiSearch){
	
}


</script>
</head>
<body onload="getLocation()">
<div id="map_canvas"></div>
</body>